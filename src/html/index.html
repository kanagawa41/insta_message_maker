<!DOCTYPE HTML>
<!--
  Spectral by HTML5 UP
  html5up.net | @ajlkn
  Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
  <head>
    <title>インスタメッセージメーカー</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="../assets/css/main.css" />
  </head>
  <body class="is-preload">

    <!-- Page Wrapper -->
      <div id="page-wrapper">

        <!-- Header -->
          <header id="header">
            <h1><a href="index.html">Insta message maker</a></h1>
<!--
            <nav id="nav">
              <ul>
                <li class="special">
                  <a href="#menu" class="menuToggle"><span>Menu</span></a>
                  <div id="menu">
                    <ul>
                      <li><a href="index.html">Home</a></li>
                      <li><a href="generic.html">Generic</a></li>
                      <li><a href="elements.html">Elements</a></li>
                      <li><a href="#">Sign Up</a></li>
                      <li><a href="#">Log In</a></li>
                    </ul>
                  </div>
                </li>
              </ul>
            </nav>
 -->
          </header>

        <!-- Main -->
          <article id="main">
            <section class="wrapper style5">
              <div class="inner">

                <section>
                  <h3>テンプレートの作成</h4>
                  <div class="row">
                    <div class="col-9 col-12-medium">
                      <form method="post" action="#">
                        <div class="row gtr-uniform">
                          <div class="col-12">
                            <h4>メッセージ</h4>
                            <textarea name="main-msg" id="main-msg" placeholder="Main message." rows="3"></textarea>
                          </div>
                          <div class="col-12">
                            <h4>ヘッダー</h4>
                            <textarea name="header-msg" id="header-msg" placeholder="Header message." rows="2"></textarea>
                          </div>
                          <div class="col-12">
                            <h4>フッター</h4>
                            <textarea name="footer-msg" id="footer-msg" placeholder="Footer message" rows="2"></textarea>
                          </div>
                          <div class="col-12">
                            <ul class="actions">
                              <li><a href="#" id="form-button-submit" class="form-button-submit button primary" onclick="return false;">Make</a></li>
                            </ul>
                          </div>
                          <div class="col-12">
                            <textarea name="make-msg" id="make-msg" placeholder="Make message" rows="5"></textarea>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="col-3 col-12-medium">
                      <form method="post" action="#">
                        <div class="row gtr-uniform">
                          <div class="col-12 col-12-xsmall">
                            <h4>^\n$</h4>
                            <p>空白改行の代わり</p>
                            <input name="new-line" placeholder="例:「・」「.」「　(大文字空白)」などを入力" type="text">
                          </div>
                          <div class="col-12 col-12-xsmall">
                            <h4>##tags##</h4>
                            <p>タグ</p>
                            <input name="tags" placeholder="カンマ(,)区切りでタグを入力" type="text">
                            <input type="checkbox" name="random-order" id="random-order">
                            <label for="random-order">タグの順番をランダム</label>
                            <input id="select-tag-num" name="select-tag-num" placeholder="タグの選択数(未入力時は全て)" type="text">
                            <input type="checkbox" name="tag-per-line" id="tag-per-line">
                            <label for="tag-per-line">タグを改行して表示</label>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </section>
              </div>
            </section>
          </article>


        <!-- Footer -->
          <footer id="footer">
<!--
            <ul class="icons">
              <li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
              <li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
              <li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
              <li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
              <li><a href="#" class="icon fa-envelope-o"><span class="label">Email</span></a></li>
            </ul>
 -->
            <ul class="copyright">
              <li>&copy; Insta message maker. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
            </ul>
          </footer>

      </div>

    <!-- Scripts -->
      <script src="../assets/js/main.js"></script>

      <script>
        const TAG_MARK = "##TAGS##";
        (function($) {
          function init(){
            $('#form-button-submit').on('click', function(){
              var headerMessage = $('textarea[name="header-msg"]').val();
              var mainMessage = $('textarea[name="main-msg"]').val();
              var footerMessage = $('textarea[name="footer-msg"]').val();

              var makeMessage = [replacer(headerMessage), replacer(mainMessage), replacer(footerMessage)].join("\n");
              $('textarea[name="make-msg"]').val(makeMessage);
            });
          }

          function replacer(str){
            str = replaceNewLine(str);

            if(hasTags(str)){
              str = replaceTags(str);
            }

            return str;
          }

          /**
           * 改行を指定の文字列に変換
           */
          function replaceNewLine(str){
            var newLine = $('input[name="new-line"]').val();
            var lines = str.split(/\r?\n/g);
            lines.forEach(function(val, i, ar){
              if(val.length == 0){
                ar[i] = newLine;
              }
            });

            return lines.join('\n');
          }

          /**
           * タグを持っているか？
           */
          function hasTags(str){
            return str.match(new RegExp(TAG_MARK));
          }

          /**
           * タグコードをタグに変換
           */
          function replaceTags(str){
            var rawTagsStr = $('input[name="tags"]').val();
            var tags = rawTagsStr.split(',');

            // タグからランダムに取得する
            if($('#select-tag-num').val() != ""){
              function randomAry(array, num) {
                var a = array;
                var t = [];
                var r = [];
                var l = a.length;
                var n = num < l ? num : l;
                while (n-- > 0) {
                  var i = Math.random() * l | 0;
                  r[n] = t[i] || a[i];
                  --l;
                  t[i] = t[l] || a[l];
                }
                return r;
              }

              var selectTagNum = $('#select-tag-num').val();
              // 指定されたタグ数が多すぎ
              if(selectTagNum > tags.length){
                selectTagNum = tags.length;
              }
              // 指定されたタグ数がマイナス
              if(tags.length < 0){
                selectTagNum = tags.length;
              }

              tags = randomAry(tags, selectTagNum);
            }

            // ランダムに配置する
            if($('#random-order').prop('checked')){
              function shuffleAry(ary) {
                var i = ary.length;
                while(i){
                  var j = Math.floor(Math.random()*i);
                  var t = ary[--i];
                  ary[i] = ary[j];
                  ary[j] = t;
                }
                return ary;
              }

              tags = shuffleAry(tags);
            }

            var tagsStr = null;
            // タグを一行毎に出力する
            if($('#tag-per-line').prop('checked')){
              tagsStr = '#' + tags.join('\n#');
            }else{
              tagsStr = '#' + tags.join(' #'); // #tag #tag...
            }

            return str.replace(new RegExp(TAG_MARK), tagsStr);
          }

          init();
        })(jQuery);
      </script>
  </body>
</html>